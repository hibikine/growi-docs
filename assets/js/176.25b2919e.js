(window.webpackJsonp=window.webpackJsonp||[]).push([[176],{836:function(t,s,a){"use strict";a.r(s);var o=a(48),r=Object(o.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"custom-bot-with-proxy-設定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-bot-with-proxy-設定","aria-hidden":"true"}},[t._v("#")]),t._v(" Custom bot with proxy 設定")]),t._v(" "),a("p",[t._v("【概念図】\n"),a("img",{attrs:{src:"/assets/images/slack-bot-outline-custom-with-proxy.png",alt:"diagram-for-custom-bot-with-proxy"}})]),t._v(" "),a("p",[t._v("Custom bot with proxy を Slack のワークスペースに導入するには、Slack アプリを作成・編集する必要があります。手順は以下の通りです。")]),t._v(" "),a("h2",{attrs:{id:"custom-bot-with-proxy-を作成する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-bot-with-proxy-を作成する","aria-hidden":"true"}},[t._v("#")]),t._v(" Custom bot with proxy を作成する")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Slack API の"),a("a",{attrs:{href:"https://api.slack.com/apps",target:"_blank",rel:"noopener noreferrer"}},[t._v("アプリページ"),a("OutboundLink")],1),t._v("に移動し、「Create New App」をクリックします。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-custom-bot1.png",alt:"slack-custom-bot1"}})])]),t._v(" "),a("li",[a("p",[t._v("「Create a Slack App」の ①「App Name」にはアプリの名前を、②「Development Slack Workspace」には\nGROWI bot を追加したいワークスペースを選択します。")])]),t._v(" "),a("li",[a("p",[t._v("「Create App」をクリックします。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-custom-bot2.png",alt:"slack-custom-bot2"}})])])]),t._v(" "),a("h2",{attrs:{id:"slackbot-proxy-を立ち上げる"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#slackbot-proxy-を立ち上げる","aria-hidden":"true"}},[t._v("#")]),t._v(" Slackbot Proxy を立ち上げる")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("packages/slackbot-proxy")]),t._v(" の配下に 新規ファイル"),a("code",[t._v(".env.development.local")]),t._v("を作成します。")]),t._v(" "),a("li",[t._v("作成したファイルに任意の環境変数"),a("code",[t._v("SERVER_URI")]),t._v("を入力してください。")])]),t._v(" "),a("p",[t._v("例: "),a("code",[t._v("SERVER_URI=http://localhost:8080")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("さらに、"),a("a",{attrs:{href:"https://api.slack.com/apps",target:"_blank",rel:"noopener noreferrer"}},[t._v("アプリページ"),a("OutboundLink")],1),t._v("から作成した Bot を選択し、"),a("code",[t._v("Basic Information")]),t._v(" > "),a("code",[t._v("App Credentials")]),t._v(" の項目を確認します。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/custom-bot-with-proxy-app-credentials.png",alt:"custom-bot-with-proxy-app-credentials"}})]),t._v(" "),a("p",[t._v("その中から "),a("code",[t._v("Client ID")]),t._v("、"),a("code",[t._v("Client Secret")]),t._v("、"),a("code",[t._v("Signing Secret")]),t._v(" を以下のように "),a("code",[t._v(".env.development.local")]),t._v(" に追加します。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SERVER_URI={ Proxy の URI }\nSLACK_CLIENT_ID={ Client ID }\nSLACK_CLIENT_SECRET={ Client Secret }\nSLACK_SIGNING_SECRET={ Signing Secret }\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[t._v("GROWI 本体サーバーとプロキシ用サーバー("),a("code",[t._v("slackbot-proxy")]),t._v(")の両方を立ち上げてください。"),a("br"),t._v("\nプロキシ用サーバーは"),a("code",[t._v("yarn")]),t._v(", "),a("code",[t._v("yarn dev")]),t._v("で起動することができます。")])]),t._v(" "),a("li",[a("p",[t._v("管理画面の Slack 連携 にて "),a("strong",[t._v("Custom bot with proxy")]),t._v(" を選択してください。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-selecting-custom-bot-with-proxy.png",alt:"slack-bot-selecting-custom-bot-with-proxy"}})])])]),t._v(" "),a("h2",{attrs:{id:"custom-bot-with-proxy-のスコープを設定する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-bot-with-proxy-のスコープを設定する","aria-hidden":"true"}},[t._v("#")]),t._v(" Custom bot with proxy のスコープを設定する")]),t._v(" "),a("ol",[a("li",[t._v("作成した Slack App の "),a("strong",[t._v("Features")]),t._v(" から "),a("strong",[t._v("OAuth & Permissions")]),t._v(" をクリックします。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-oauth-and-permissions-introduction-no-check.png",alt:"slack-bot-oauth-and-permissions-introduction-no-check"}})]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("Add an OAuth Scope")]),t._v(" をクリックします。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-scope-add-oauth-click.png",alt:"slack-bot-scope-add-oauth-click"}})]),t._v(" "),a("ol",[a("li",[t._v("以下を全て追加します\n"),a("ul",[a("li",[a("code",[t._v("commands")])]),t._v(" "),a("li",[a("code",[t._v("team:read")])]),t._v(" "),a("li",[a("code",[t._v("chat:write")])]),t._v(" "),a("li",[a("code",[t._v("chat:write.public")])]),t._v(" "),a("li",[a("code",[t._v("channels:join")])]),t._v(" "),a("li",[a("code",[t._v("channels:history")])]),t._v(" "),a("li",[a("code",[t._v("groups:history")])]),t._v(" "),a("li",[a("code",[t._v("im:history")])]),t._v(" "),a("li",[a("code",[t._v("mpim:history")])])])])]),t._v(" "),a("p",[t._v("以下のように表示されたら、スコープの設定は完了です。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-scope-selected.png",alt:"slack-bot-scope-selected"}})]),t._v(" "),a("h2",{attrs:{id:"request-url-設定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#request-url-設定","aria-hidden":"true"}},[t._v("#")]),t._v(" Request URL 設定")]),t._v(" "),a("h3",{attrs:{id:"interactivity-shortcuts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interactivity-shortcuts","aria-hidden":"true"}},[t._v("#")]),t._v(" Interactivity & Shortcuts")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("作成した Slack App の "),a("strong",[t._v("Features")]),t._v(" から "),a("strong",[t._v("Interactivity Shortcuts")]),t._v(" をクリックします。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-interactivity-shortcuts-introduction.png",alt:"slack-bot-interactivity-shortcuts-introduction"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Interactivity")]),t._v(" 右側にあるボタンを On にします。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-interactivity-shortcuts-enable-button.png",alt:"slack-bot-interactivity-shortcuts-enable-button"}})])]),t._v(" "),a("li",[a("p",[t._v("Request URL を以下のように入力してください。")])])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("https://{連携させたい proxy のドメイン名}/slack/interactions")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("例 "),a("code",[t._v("https://example.com/slack/interactions")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-interactiviry-shortcuts-for-with-proxy.png",alt:"slack-bot-interactiviry-shortcuts-for-with-proxy"}})]),t._v(" "),a("ol",[a("li",[t._v("入力が完了したら、右下の "),a("strong",[t._v("Save Changes")]),t._v(" ボタンをクリックしてください。")])])])])])]),t._v(" "),a("h3",{attrs:{id:"slash-commands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#slash-commands","aria-hidden":"true"}},[t._v("#")]),t._v(" Slash Commands")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("作成した Slack App の "),a("strong",[t._v("Features")]),t._v(" から "),a("strong",[t._v("Slash Commands")]),t._v(" をクリックします。\n"),a("img",{attrs:{src:"/assets/images/slash-commands-introduction.png",alt:"slash-commands-introduction"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Create New Command")]),t._v(" をクリックします。\n"),a("img",{attrs:{src:"/assets/images/slash-commands-create-new-command.png",alt:"slash-commands-create-new-command"}})]),t._v(" "),a("ul",[a("li",[t._v("Command に /growi と入力してください。")]),t._v(" "),a("li",[t._v("Request URL には、"),a("code",[t._v("https://example.com/slack/commands")]),t._v(" と入力してください")]),t._v(" "),a("li",[t._v("Short Description も入力必須のため、適当なご説明を入力してください。")]),t._v(" "),a("li",[t._v("Usage Hint に関しては任意なので、適宜入力してください。")]),t._v(" "),a("li",[t._v("Escape channels, users, and links sent to your app に関しては任意なので、適宜入力してください。")]),t._v(" "),a("li",[t._v("入力が完了したら、右下の "),a("strong",[t._v("Save")]),t._v(" ボタンをクリックしてください。")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slash-commands-create.png",alt:"slash-commands-create"}})]),t._v(" "),a("h2",{attrs:{id:"redirect-url-設定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redirect-url-設定","aria-hidden":"true"}},[t._v("#")]),t._v(" Redirect URL 設定")]),t._v(" "),a("h3",{attrs:{id:"oauth-permissions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth-permissions","aria-hidden":"true"}},[t._v("#")]),t._v(" OAuth & Permissions")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("作成した Slack App の "),a("strong",[t._v("Features")]),t._v(" から "),a("strong",[t._v("OAuth & Permissions")]),t._v(" をクリックします。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Redirect URLs")]),t._v(" の "),a("strong",[t._v("Add New Redirect URL")]),t._v(" ボタンをクリックします。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-auth-and-permisions1.png",alt:"slash-commands-introduction"}})])]),t._v(" "),a("li",[a("p",[t._v("入力欄が表示されるので、"),a("code",[t._v("https://{連携させたい proxy のドメイン名}/slack/oauth_redirect")]),t._v(" を入力してください。")]),t._v(" "),a("ul",[a("li",[t._v("例 "),a("code",[t._v("https://example.com/slack/oauth_redirect")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-auth-and-permisions2.png",alt:"slash-commands-introduction"}})])]),t._v(" "),a("li",[a("p",[t._v("入力したら "),a("strong",[t._v("Add")]),t._v(" ボタン をクリックしてください。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Save URLs")]),t._v(" ボタンをクリックして 入力した URL を保存します。")])])]),t._v(" "),a("h2",{attrs:{id:"custom-bot-with-proxy-を-slack-のワークスペースへインストールする"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-bot-with-proxy-を-slack-のワークスペースへインストールする","aria-hidden":"true"}},[t._v("#")]),t._v(" Custom bot with proxy を Slack のワークスペースへインストールする")]),t._v(" "),a("ol",[a("li",[t._v("作成した Slack App の "),a("strong",[t._v("Settings")]),t._v(" から "),a("strong",[t._v("Manage distribution")]),t._v(" をクリックします。")]),t._v(" "),a("li",[a("strong",[t._v("Share Your App with Other Workspaces")]),t._v(" の 4 つの項目全てにチェックマークがついたら、"),a("strong",[t._v("Activate Public Distribution")]),t._v(" を押します。\n"),a("img",{attrs:{src:"/assets/images/activate-public-dist.png",alt:"activate-public-dist"}})]),t._v(" "),a("li",[t._v("ページ上部の "),a("strong",[t._v("Add to Slack")]),t._v(" ボタンを押します。")]),t._v(" "),a("li",[t._v("遷移先の画面にて、Allow をクリックします。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-install-your-app-transition-destination.png",alt:"slack-bot-install-your-app-transition-destination"}})]),t._v(" "),a("li",[a("strong",[t._v("Congratulations!")]),t._v(" と表示されたら Install が完了です。")]),t._v(" "),a("li",[t._v("GROWI bot を使いたいチャンネルに @example を使用して招待します。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-install-to-workspace-joined-bot.png",alt:"slack-bot-install-to-workspace-joined-bot"}}),t._v(" "),a("img",{attrs:{src:"/assets/images/slack-bot-install-your-app-introduction-to-channel.png",alt:"slack-bot-install-your-app-introduction-to-channel"}})])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("code",[t._v("Illegal state, try it again.")]),t._v(" と表示される場合は、"),a("strong",[t._v("Go to install page")]),t._v(" を押し、表示される "),a("strong",[t._v("Add to Slack")]),t._v(" ボタンから再度インストールを行ってください。\nまたは "),a("code",[t._v("GROWI Bot installation failed..")]),t._v(" と表示される場合は、"),a("strong",[t._v("Add to Slack")]),t._v(" ボタンからリトライしてください。")])]),t._v(" "),a("h2",{attrs:{id:"growi-custom-bot-with-proxy-サービスへの登録"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#growi-custom-bot-with-proxy-サービスへの登録","aria-hidden":"true"}},[t._v("#")]),t._v(" GROWI Custom Bot with proxy サービスへの登録")]),t._v(" "),a("ol",[a("li",[t._v("GROWI Custom Bot with proxy サービスへの登録を開きます。"),a("br"),t._v(" "),a("strong",[t._v("Access Token の発行")]),t._v(" に各種トークンにアクセストークンが 2 種生成されていることを確認できます。\nアクセストークンは必要に応じて再発行できます。")]),t._v(" "),a("li",[t._v("Slack 上で "),a("code",[t._v("/growi register")]),t._v(" と打ちます。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-growi-register.png",alt:"slack-bot-growi-register"}}),t._v(" "),a("img",{attrs:{src:"/assets/images/slack-bot-register-modal.png",alt:"slack-bot-add-workspace"}})]),t._v(" "),a("li",[t._v("表示されるモーダルの GROWI URL に、対象 GROWI の URL を保存します。")]),t._v(" "),a("li",[t._v("上記で発行されている Access Token Proxy to GROWI と Access Token GROWI to Proxy を入れ "),a("strong",[t._v("Submit")]),t._v(" ボタンを押します。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-update-proxy-url.png",alt:"slack-bot-update-proxy-url"}})]),t._v(" "),a("p",[t._v("成功した場合、 proxy サーバーの URL が表示されます。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/slack-bot-input-proxy-url.png",alt:"slack-bot-input-proxy-url"}})]),t._v(" "),a("p",[t._v("上記で取得した proxy サーバーの URL を "),a("strong",[t._v("Custom Bot With Proxy Integration")]),t._v(" の Proxy URL に入力し更新します。")]),t._v(" "),a("h2",{attrs:{id:"custom-bot-with-proxy-の接続テストを実行する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-bot-with-proxy-の接続テストを実行する","aria-hidden":"true"}},[t._v("#")]),t._v(" Custom bot with proxy の接続テストを実行する")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("「Test connection」をクリックし、GROWI-Bot を招待した Slack チャンネルを入力します。\n"),a("img",{attrs:{src:"/assets/images/slack-bot-test-introduction-custom-with-proxy.png",alt:"slack-bot-test-introduction"}})])]),t._v(" "),a("li",[a("p",[t._v("「Test」 ボタンをクリックします。")])])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("成功の場合"),a("br"),t._v(" "),a("strong",[t._v("Successfully sent to Slack workspace.")]),t._v(" が Logs に表示され、\n赤丸で囲った部分に緑色のチェックマークが表示されます。GROWI-Bot を招待した Slack チャンネルで確認してみましょう。")]),t._v(" "),a("ul",[a("li",[t._v("GROWI 側\n"),a("img",{attrs:{src:"/assets/images/slack-bot-test-success-custom-with-proxy.png",alt:"slack-bot-test-success"}})]),t._v(" "),a("li",[t._v("Slack 側\n"),a("img",{attrs:{src:"/assets/images/slack-bot-test-success-at-slack-app.png",alt:"slack-bot-test-success-at-slack-app"}})])])]),t._v(" "),a("li",[a("p",[t._v("失敗の場合"),a("br"),t._v(" "),a("RouterLink",{attrs:{to:"/ja/admin-guide/management-cookbook/slack-integration/#接続テスト時のエラーログ"}},[t._v("接続テスト時のエラーログ")]),t._v("を参照してください。")],1)])]),t._v(" "),a("p",[t._v("全ての設定が完了したら "),a("RouterLink",{attrs:{to:"/ja/admin-guide/management-cookbook/slack-integration/#growi-bot-でできること"}},[t._v("GROWI bot でできること")]),t._v("を参照してください。")],1)])},[],!1,null,null,null);s.default=r.exports}}]);